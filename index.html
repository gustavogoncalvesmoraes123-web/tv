<script>
var video = document.getElementById('video');
var info = document.getElementById('info');
var listaDiv = document.getElementById('listaCanais');

var urlM3U = 'https://raw.githubusercontent.com/Ramys/Iptv-Brasil-2026/refs/heads/master/CanaisBR%20-%20Completo.m3u8';

var canais = [];
var quantidadePorVez = 20;
var indiceAtual = 0;

function darPlay(url, nome) {
    info.innerHTML = "Reproduzindo: " + nome;
    video.src = url;
    video.play();
}

function mostrarMais() {
    var contador = 0;

    while (contador < quantidadePorVez && indiceAtual < canais.length) {

        var canal = canais[indiceAtual];

        var btn = document.createElement("button");
        btn.className = "canal";
        btn.innerHTML = canal.nome;

        btn.onclick = (function(link, nome) {
            return function() {
                darPlay(link, nome);
            };
        })(canal.link, canal.nome);

        listaDiv.appendChild(btn);

        indiceAtual++;
        contador++;
    }

    if (indiceAtual < canais.length) {
        setTimeout(mostrarMais, 100);
    }
}

var xhr = new XMLHttpRequest();
xhr.open('GET', urlM3U, true);

xhr.onreadystatechange = function() {
    if (xhr.readyState == 4) {
        if (xhr.status == 200) {

            var linhas = xhr.responseText.split('\n');

            var i;
            for (i = 0; i < linhas.length; i++) {

                if (linhas[i].indexOf('#EXTINF:') != -1) {

                    var partes = linhas[i].split(',');
                    var nome = "Canal";

                    if (partes.length > 1) {
                        nome = partes[1];
                    }

                    if (linhas[i+1]) {
                        var link = linhas[i+1].replace(/\r/g, '').trim();
                        canais.push({nome: nome, link: link});
                    }
                }
            }

            listaDiv.innerHTML = "";
            mostrarMais();

        } else {
            listaDiv.innerHTML = "Erro ao carregar lista. Status: " + xhr.status;
        }
    }
};

xhr.send();
                    </script>
