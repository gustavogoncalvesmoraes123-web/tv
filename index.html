<script>
var video = document.getElementById('video');
var info = document.getElementById('info');
var listaDiv = document.getElementById('listaCanais');

var urlM3U = 'https://raw.githubusercontent.com/Ramys/Iptv-Brasil-2026/refs/heads/master/CanaisBR%20-%20Completo.m3u8';

var canais = [];
var quantidadePorVez = 30;
var indiceAtual = 0;

function darPlay(url, nome) {
    info.innerText = "Reproduzindo: " + nome;
    video.src = url;
    video.play();
}

function mostrarMais() {
    var contador = 0;
    while (contador < quantidadePorVez && indiceAtual < canais.length) {
        var canal = canais[indiceAtual];

        var btn = document.createElement("button");
        btn.className = "canal";
        btn.textContent = canal.nome;
        btn.onclick = function(link, nome) {
            return function() { darPlay(link, nome); };
        }(canal.link, canal.nome);

        listaDiv.appendChild(btn);

        indiceAtual++;
        contador++;
    }

    if (indiceAtual < canais.length) {
        setTimeout(mostrarMais, 50); // carrega aos poucos
    }
}

fetch(urlM3U)
.then(function(response) {
    return response.text();
})
.then(function(texto) {
    var linhas = texto.split('\n');

    for (var i = 0; i < linhas.length; i++) {
        if (linhas[i].indexOf('#EXTINF:') !== -1) {
            var nome = linhas[i].split(',')[1] || "Canal";
            var link = linhas[i + 1] ? linhas[i + 1].trim() : null;

            if (link) {
                canais.push({ nome: nome, link: link });
            }
        }
    }

    listaDiv.innerHTML = "";
    mostrarMais();
})
.catch(function() {
    listaDiv.innerHTML = "Erro ao carregar lista.";
});
</script>
