<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamTV Lite</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@0.14.17"></script>
    <style>
        /* CSS: O visual do site */
        body { background: #000; color: #fff; font-family: Arial, sans-serif; margin: 0; overflow-x: hidden; }
        #fixo { position: sticky; top: 0; width: 100%; background: #000; z-index: 100; border-bottom: 2px solid #ff0000; }
        video { width: 100%; height: 210px; background: #111; }
        #menu-grupos { display: flex; overflow-x: auto; padding: 10px; background: #222; gap: 10px; }
        .aba { padding: 10px 15px; background: #444; border: none; color: #fff; border-radius: 5px; white-space: nowrap; cursor: pointer; }
        .aba:active { background: #ff0000; }
        .lista { padding: 15px; }
        .canal { 
            display: block; width: 100%; padding: 15px; margin-bottom: 8px;
            background: #1a1a1a; color: #fff; border: 1px solid #333; 
            border-radius: 5px; text-align: left; font-size: 16px;
        }
        .canal:active { background: #333; border-color: #ff0000; }
        #status { padding: 5px; font-size: 12px; color: #ffff00; text-align: center; }
    </style>
</head>
<body>

<div id="fixo">
    <video id="video" controls autoplay playsinline muted></video>
    <div id="status">Carregando lista...</div>
    <div id="menu-grupos"></div>
</div>

<div class="lista" id="listaCanais">Escolha uma categoria acima.</div>

<script>
    /* JAVASCRIPT: O cérebro do site */
    var video = document.getElementById('video');
    var statusTxt = document.getElementById('status');
    var menuGrupos = document.getElementById('menu-grupos');
    var abaCanais = document.getElementById('listaCanais');
    var todosCanais = [];

    // --- COLOQUE O SEU LINK DA LISTA M3U ABAIXO ---
    var urlListaM3U = 'https://raw.githubusercontent.com/Ramys/Iptv-Brasil-2026/refs/heads/master/CanaisBR%20-%20Completo.m3u8'; 
    // Usamos o proxy para evitar bloqueios de segurança (CORS)
    var urlFinal = 'https://corsproxy.io/?' + encodeURIComponent(urlListaM3U);

    function darPlay(url, nome) {
        statusTxt.innerText = "Reproduzindo: " + nome;
        if (Hls.isSupported()) {
            var hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() { video.play(); });
        } else {
            video.src = url;
            video.play();
        }
    }

    function filtrarPorGrupo(nomeG) {
        var html = '';
        var limite = 0;
        for (var i = 0; i < todosCanais.length; i++) {
            if (todosCanais[i].grupo === nomeG) {
                html += '<button class="canal" onclick="darPlay(\''+todosCanais[i].link+'\', \''+todosCanais[i].nome+'\')">' + todosCanais[i].nome + '</button>';
                limite++;
            }
            if (limite > 100) break; // Não carrega mais de 100 pra não travar a TV
        }
        abaCanais.innerHTML = html;
        window.scrollTo(0,0);
    }

    // Carregar a lista do GitHub/URL
    var xhr = new XMLHttpRequest();
    xhr.open('GET', urlFinal, true);
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            var linhas = xhr.responseText.split('\n');
            var gruposEncontrados = [];
            
            for (var i = 0; i < linhas.length; i++) {
                if (linhas[i].indexOf('#EXTINF:') !== -1 && linhas[i+1]) {
                    // Pega o grupo
                    var gMatch = linhas[i].match(/group-title="([^"]+)"/);
                    var grupo = gMatch ? gMatch[1] : "OUTROS";
                    
                    // Pega o nome e o link
                    var nome = linhas[i].split(',')[1] || "Canal";
                    var link = linhas[i+1].trim();

                    if (link.indexOf('http') === 0) {
                        todosCanais.push({nome: nome, link: link, grupo: grupo});
                        if (gruposEncontrados.indexOf(grupo) === -1) {
                            gruposEncontrados.push(grupo);
                            // Cria botão da categoria na hora
                            var b = document.createElement('button');
                            b.className = 'aba';
                            b.innerText = grupo;
                            b.onclick = (function(g){ return function(){ filtrarPorGrupo(g); } })(grupo);
                            menuGrupos.appendChild(b);
                        }
                    }
                    i++; 
                }
            }
            statusTxt.innerText = "Lista pronta! Canais carregados: " + todosCanais.length;
        }
    };
    xhr.send();
</script>

</body>
</html>
