<script>
var video = document.getElementById('video');
var info = document.getElementById('info');
var listaDiv = document.getElementById('listaCanais');

var urlM3U = 'https://raw.githubusercontent.com/Ramys/Iptv-Brasil-2026/refs/heads/master/CanaisBR%20-%20Completo.m3u8';

var canais = [];
var quantidadePorVez = 50;
var indiceAtual = 0;

function darPlay(url, nome) {
    info.innerText = "Reproduzindo: " + nome;
    video.src = url;
    video.play();
}

function mostrarMais() {
    var limite = indiceAtual + quantidadePorVez;
    for (var i = indiceAtual; i < limite && i < canais.length; i++) {
        var btn = document.createElement("button");
        btn.className = "canal";
        btn.innerText = canais[i].nome;
        btn.onclick = (function(link, nome) {
            return function() {
                darPlay(link, nome);
            };
        })(canais[i].link, canais[i].nome);
        listaDiv.appendChild(btn);
    }
    indiceAtual = limite;

    if (indiceAtual >= canais.length) {
        btnCarregar.style.display = "none";
    }
}

var btnCarregar = document.createElement("button");
btnCarregar.innerText = "Carregar mais canais";
btnCarregar.className = "canal";
btnCarregar.onclick = mostrarMais;

fetch(urlM3U)
.then(response => response.text())
.then(texto => {
    var linhas = texto.split('\n');
    for (var i = 0; i < linhas.length; i++) {
        if (linhas[i].indexOf('#EXTINF:') !== -1) {
            var nome = linhas[i].split(',')[1] || "Canal";
            var link = linhas[i + 1]?.trim();
            if (link) {
                canais.push({ nome: nome, link: link });
            }
        }
    }

    listaDiv.innerHTML = "";
    mostrarMais();
    listaDiv.appendChild(btnCarregar);
})
.catch(err => {
    listaDiv.innerHTML = "Erro ao carregar lista.";
});
</script>
